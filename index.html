<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live-screen Maths by MAHESHWARI sir - Matrix Quiz</title>
    <style>
        /* General body styling */
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }

        /* Container for the entire quiz */
        .container {
            max-width: 800px;
            margin: auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        /* Styling for main headings */
        h1, h2 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 20px;
        }

        /* Styling for individual questions */
        .question {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        /* Styling for question text */
        .question p {
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* Styling for radio button options */
        .options label {
            display: block;
            margin-bottom: 8px;
            cursor: pointer;
        }

        /* Styling for radio input elements */
        .options input[type="radio"] {
            margin-right: 10px;
        }

        /* Styling for feedback messages (correct/incorrect) */
        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none; /* Hidden by default */
        }

        /* Styling for correct feedback */
        .correct-feedback {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        /* Styling for incorrect feedback */
        .incorrect-feedback {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Styling for the initial screen (name/email input) */
        .initial-screen {
            text-align: center;
            padding: 40px;
        }

        /* Styling for input fields on the initial screen */
        .initial-screen input[type="email"],
        .initial-screen input[type="text"] {
            padding: 10px;
            margin: 10px 0;
            width: 80%;
            max-width: 300px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Styling for all buttons */
        .initial-screen button, .quiz-submit-button, .download-button, .retake-button {
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            margin-top: 10px; /* Add margin for spacing */
        }

        /* Hover effect for buttons */
        .initial-screen button:hover, .quiz-submit-button:hover, .download-button:hover {
            background-color: #0056b3;
        }

        /* Specific styling for the retake button */
        .retake-button {
            background-color: #6c757d; /* Different color for retake button */
        }

        /* Hover effect for retake button */
        .retake-button:hover {
            background-color: #5a6268;
        }

        /* Quiz section hidden by default */
        .quiz-section {
            display: none;
        }

        /* Result section hidden by default */
        .result-section {
            display: none;
            text-align: center;
            padding: 30px;
            background-color: #e9f5ff;
            border-radius: 8px;
            margin-top: 20px;
        }

        /* Styling for result section heading */
        .result-section h2 {
            color: #0056b3;
        }

        /* Styling for the score display */
        .score {
            font-size: 2em;
            font-weight: bold;
            color: #28a745;
            margin: 15px 0;
        }

        /* Modal styling for alerts */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Live-screen Maths by MAHESHWARI sir<br>Build the foundation for JEE with 11th & 12th Class</h1>

        <div id="initialScreen" class="initial-screen">
            <h2>Welcome to the Matrix Quiz!</h2>
            <p>Please enter your name and email ID to start the quiz.</p>
            <input type="text" id="studentName" placeholder="Your Name" required><br>
            <input type="email" id="studentEmail" placeholder="Your Email ID (optional)"><br>
            <button onclick="startQuiz()">Start Quiz</button>
        </div>

        <div id="quizSection" class="quiz-section">
            <form id="matrixQuiz">
                <div class="question">
                    <p>1. What is the order of a matrix with m rows and n columns?</p>
                    <div class="options">
                        <label><input type="radio" name="q1" value="A"> m × n</label>
                        <label><input type="radio" name="q1" value="B"> n × m</label>
                        <label><input type="radio" name="q1" value="C"> m+n</label>
                        <label><input type="radio" name="q1" value="D"> m-n</label>
                    </div>
                    <div class="feedback" id="feedback1"></div>
                </div>

                <div class="question">
                    <p>2. A square matrix is a matrix in which:</p>
                    <div class="options">
                        <label><input type="radio" name="q2" value="A"> Number of rows is greater than number of columns</label>
                        <label><input type="radio" name="q2" value="B"> Number of columns is greater than number of rows</label>
                        <label><input type="radio" name="q2" value="C"> Number of rows is equal to number of columns</label>
                        <label><input type="radio" name="q2" value="D"> All elements are zero</label>
                    </div>
                    <div class="feedback" id="feedback2"></div>
                </div>

                <div class="question">
                    <p>3. If
                        \[A = \begin{pmatrix} 2 & 3 \\ 4 & 5 \end{pmatrix}\]
                        and
                        \[B = \begin{pmatrix} 1 & 0 \\ 0 & 1 \end{pmatrix}\],
                        then A+B is:
                    </p>
                    <div class="options">
                        <label><input type="radio" name="q3" value="A"> \[\begin{pmatrix} 3 & 3 \\ 4 & 6 \end{pmatrix}\]</label>
                        <label><input type="radio" name="q3" value="B"> \[\begin{pmatrix} 2 & 3 \\ 4 & 5 \end{pmatrix}\]</label>
                        <label><input type="radio" name="q3" value="C"> \[\begin{pmatrix} 1 & 3 \\ 4 & 4 \end{pmatrix}\]</label>
                        <label><input type="radio" name="q3" value="D"> \[\begin{pmatrix} 3 & 4 \\ 5 & 6 \end{pmatrix}\]</label>
                    </div>
                    <div class="feedback" id="feedback3"></div>
                </div>

                <div class="question">
                    <p>4. The transpose of a matrix A is denoted by:</p>
                    <div class="options">
                        <label><input type="radio" name="q4" value="A"> A<sup>-1</sup></label>
                        <label><input type="radio" name="q4" value="B"> A<sup>T</sup></label>
                        <label><input type="radio" name="q4" value="C"> |A|</label>
                        <label><input type="radio" name="q4" value="D"> A*</label>
                    </div>
                    <div class="feedback" id="feedback4"></div>
                </div>

                <div class="question">
                    <p>5. For two matrices A and B to be conformable for multiplication AB, the number of columns in A must be equal to:</p>
                    <div class="options">
                        <label><input type="radio" name="q5" value="A"> Number of rows in B</label>
                        <label><input type="radio" name="q5" value="B"> Number of columns in B</label>
                        <label><input type="radio" name="q5" value="C"> Number of rows in A</label>
                        <label><input type="radio" name="q5" value="D"> Number of columns in A</label>
                    </div>
                    <div class="feedback" id="feedback5"></div>
                </div>

                <div class="question">
                    <p>6. The determinant of a 2 × 2 matrix \[\begin{pmatrix} a & b \\ c & d \end{pmatrix}\] is:</p>
                    <div class="options">
                        <label><input type="radio" name="q6" value="A"> ad+bc</label>
                        <label><input type="radio" name="q6" value="B"> ad-bc</label>
                        <label><input type="radio" name="q6" value="C"> ac-bd</label>
                        <label><input type="radio" name="q6" value="D"> ab-cd</label>
                    </div>
                    <div class="feedback" id="feedback6"></div>
                </div>

                <div class="question">
                    <p>7. A diagonal matrix is a square matrix in which all non-diagonal elements are:</p>
                    <div class="options">
                        <label><input type="radio" name="q7" value="A"> One</label>
                        <label><input type="radio" name="q7" value="B"> Zero</label>
                        <label><input type="radio" name="q7" value="C"> Negative</label>
                        <label><input type="radio" name="q7" value="D"> Positive</label>
                    </div>
                    <div class="feedback" id="feedback7"></div>
                </div>

                <div class="question">
                    <p>8. The identity matrix of order n × n is denoted by:</p>
                    <div class="options">
                        <label><input type="radio" name="q8" value="A"> O</label>
                        <label><input type="radio" name="q8" value="B"> I<sub>n</sub></label>
                        <label><input type="radio" name="q8" value="C"> A</label>
                        <label><input type="radio" name="q8" value="D"> J</label>
                    </div>
                    <div class="feedback" id="feedback8"></div>
                </div>

                <div class="question">
                    <p>9. If A is a matrix and k is a scalar, then the element (kA)<sub>ij</sub> is equal to:</p>
                    <div class="options">
                        <label><input type="radio" name="q9" value="A"> k + a<sub>ij</sub></label>
                        <label><input type="radio" name="q9" value="B"> k × a<sub>ij</sub></label>
                        <label><input type="radio" name="q9" value="C"> a<sub>ij</sub> / k</label>
                        <label><input type="radio" name="q9" value="D"> a<sub>ij</sub> - k</label>
                    </div>
                    <div class="feedback" id="feedback9"></div>
                </div>

                <div class="question">
                    <p>10. The inverse of a matrix A exists if and only if its determinant is:</p>
                    <div class="options">
                        <label><input type="radio" name="q10" value="A"> Zero</label>
                        <label><input type="radio" name="q10" value="B"> Non-zero</label>
                        <label><input type="radio" name="q10" value="C"> Negative</label>
                        <label><input type="radio" name="q10" value="D"> Positive</label>
                    </div>
                    <div class="feedback" id="feedback10"></div>
                </div>

                <div class="question">
                    <p>11. Which of the following is NOT a type of matrix?</p>
                    <div class="options">
                        <label><input type="radio" name="q11" value="A"> Row Matrix</label>
                        <label><input type="radio" name="q11" value="B"> Column Matrix</label>
                        <label><input type="radio" name="q11" value="C"> Circular Matrix</label>
                        <label><input type="radio" name="q11" value="D"> Zero Matrix</label>
                    </div>
                    <div class="feedback" id="feedback11"></div>
                </div>

                <div class="question">
                    <p>12. For what value of x is the matrix \[\begin{pmatrix} 2 & x \\ 4 & 8 \end{pmatrix}\] singular?</p>
                    <div class="options">
                        <label><input type="radio" name="q12" value="A"> 2</label>
                        <label><input type="radio" name="q12" value="B"> 4</label>
                        <label><input type="radio" name="q12" value="C"> 8</label>
                        <label><input type="radio" name="q12" value="D"> 16</label>
                    </div>
                    <div class="feedback" id="feedback12"></div>
                </div>

                <div class="question">
                    <p>13. If A and B are two matrices such that AB exists, then (AB)<sup>T</sup> is equal to:</p>
                    <div class="options">
                        <label><input type="radio" name="q13" value="A"> A<sup>T</sup> B<sup>T</sup></label>
                        <label><input type="radio" name="q13" value="B"> B<sup>T</sup> A<sup>T</sup></label>
                        <label><input type="radio" name="q13" value="C"> AB</label>
                        <label><input type="radio" name="q13" value="D"> BA</label>
                    </div>
                    <div class="feedback" id="feedback13"></div>
                </div>

                <div class="question">
                    <p>14. The element in the i-th row and j-th column of a matrix A is denoted by:</p>
                    <div class="options">
                        <label><input type="radio" name="q14" value="A"> a<sub>ji</sub></label>
                        <label><input type="radio" name="q14" value="B"> a<sub>ij</sub></label>
                        <label><input type="radio" name="q14" value="C"> A<sub>ij</sub></label>
                        <label><input type="radio" name="q14" value="D"> A<sub>ji</sub></label>
                    </div>
                    <div class="feedback" id="feedback14"></div>
                </div>

                <div class="question">
                    <p>15. What is a symmetric matrix?</p>
                    <div class="options">
                        <label><input type="radio" name="q15" value="A"> A matrix where A = A<sup>T</sup></label>
                        <label><input type="radio" name="q15" value="B"> A matrix where A = -A<sup>T</sup></label>
                        <label><input type="radio" name="q15" value="C"> A matrix where all elements are zero</label>
                        <label><input type="radio" name="q15" value="D"> A matrix where all diagonal elements are one</label>
                    </div>
                    <div class="feedback" id="feedback15"></div>
                </div>

                <div class="question">
                    <p>16. The product of a matrix and its inverse is:</p>
                    <div class="options">
                        <label><input type="radio" name="q16" value="A"> An Identity Matrix</label>
                        <label><input type="radio" name="q16" value="B"> A Zero Matrix</label>
                        <label><input type="radio" name="q16" value="C"> The original matrix</label>
                        <label><input type="radio" name="q16" value="D"> Undefined</label>
                    </div>
                    <div class="feedback" id="feedback16"></div>
                </div>

                <div class="question">
                    <p>17. If A is an invertible matrix, then (A<sup>-1</sup>)<sup>-1</sup> is equal to:</p>
                    <div class="options">
                        <label><input type="radio" name="q17" value="A"> A</label>
                        <label><input type="radio" name="q17" value="B"> A<sup>-1</sup></label>
                        <label><input type="radio" name="q17" value="C"> I</label>
                        <label><input type="radio" name="q17" value="D"> O</label>
                    </div>
                    <div class="feedback" id="feedback17"></div>
                </div>

                <div class="question">
                    <p>18. A scalar matrix is a diagonal matrix where:</p>
                    <div class="options">
                        <label><input type="radio" name="q18" value="A"> All diagonal elements are equal</label>
                        <label><input type="radio" name="q18" value="B"> All non-diagonal elements are one</label>
                        <label><input type="radio" name="q18" value="C"> Only one diagonal element is non-zero</label>
                        <label><input type="radio" name="q18" value="D"> All diagonal elements are different</label>
                    </div>
                    <div class="feedback" id="feedback18"></div>
                </div>

                <div class="question">
                    <p>19. The determinant of an identity matrix of any order is:</p>
                    <div class="options">
                        <label><input type="radio" name="q19" value="A"> 0</label>
                        <label><input type="radio" name="q19" value="B"> 1</label>
                        <label><input type="radio" name="q19" value="C"> -1</label>
                        <label><input type="radio" name="q19" value="D"> Varies with order</label>
                    </div>
                    <div class="feedback" id="feedback19"></div>
                </div>

                <div class="question">
                    <p>20. If A and B are two matrices of the same order, then (A+B)<sup>T</sup> is equal to:</p>
                    <div class="options">
                        <label><input type="radio" name="q20" value="A"> A<sup>T</sup> - B<sup>T</sup></label>
                        <label><input type="radio" name="q20" value="B"> BA</label>
                        <label><input type="radio" name="q20" value="C"> A<sup>T</sup> + B<sup>T</sup></label>
                        <label><input type="radio" name="q20" value="D"> AB</label>
                    </div>
                    <div class="feedback" id="feedback20"></div>
                </div>

                <button type="submit" class="quiz-submit-button">Submit Quiz</button>
            </form>
        </div>

        <div id="resultSection" class="result-section">
            <h2>MAHESHWARI Sir evaluation score</h2>
            <p>Name: <span id="displayStudentName"></span></p>
            <p>Email: <span id="displayStudentEmail"></span></p>
            <p>You scored: <span id="scoreDisplay" class="score"></span> out of 20</p>
            <button class="download-button" onclick="downloadResults()">Download Results</button>
            <button class="retake-button" onclick="retakeQuiz()">Retake Quiz</button>
        </div>
    </div>

    <div id="customModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modalMessage"></p>
            <button onclick="closeModal()">OK</button>
        </div>
    </div>

    <script>
        // Define correct answers for each question
        const correctAnswers = {
            q1: 'A', q2: 'C', q3: 'A', q4: 'B', q5: 'A',
            q6: 'B', q7: 'B', q8: 'B', q9: 'B', q10: 'B',
            q11: 'C', q12: 'B', q13: 'B', q14: 'B', q15: 'A',
            q16: 'A', q17: 'A', q18: 'A', q19: 'B', q20: 'C'
        };

        // Define feedback messages for correct and incorrect answers
        const feedbackMessages = {
            q1: {
                correct: 'Correct! The order of a matrix is given by rows × columns.',
                incorrect: 'Incorrect. The order of a matrix is given by rows × columns.'
            },
            q2: {
                correct: 'Correct! In a square matrix, the number of rows equals the number of columns.',
                incorrect: 'Incorrect. A square matrix has an equal number of rows and columns.'
            },
            q3: {
                correct: 'Correct! Matrix addition is done element-wise.',
                incorrect: 'Incorrect. For matrix addition, add corresponding elements.'
            },
            q4: {
                correct: 'Correct! A<sup>T</sup> denotes the transpose of matrix A.',
                incorrect: 'Incorrect. The transpose is denoted by A<sup>T</sup>.'
            },
            q5: {
                correct: 'Correct! For AB to exist, columns in A must equal rows in B.',
                incorrect: 'Incorrect. The number of columns in the first matrix must equal the number of rows in the second.'
            },
            q6: {
                correct: 'Correct! The determinant of a 2x2 matrix is ad-bc.',
                incorrect: 'Incorrect. The determinant of a 2x2 matrix is (a*d) - (b*c).'
            },
            q7: {
                correct: 'Correct! All non-diagonal elements in a diagonal matrix are zero.',
                incorrect: 'Incorrect. Non-diagonal elements in a diagonal matrix are zero.'
            },
            q8: {
                correct: 'Correct! The identity matrix is typically denoted by I<sub>n</sub>.',
                incorrect: 'Incorrect. I<sub>n</sub> represents the identity matrix of order n.'
            },
            q9: {
                correct: 'Correct! Scalar multiplication multiplies each element by the scalar.',
                incorrect: 'Incorrect. (kA)<sub>ij</sub> = k × a<sub>ij</sub>.'
            },
            q10: {
                correct: 'Correct! An inverse exists if and only if the determinant is non-zero.',
                incorrect: 'Incorrect. A matrix is invertible if and only if its determinant is non-zero.'
            },
            q11: {
                correct: 'Correct! Circular matrix is not a standard type of matrix.',
                incorrect: 'Incorrect. Row, Column, and Zero matrices are standard types.'
            },
            q12: {
                correct: 'Correct! For a matrix to be singular, its determinant must be zero (2*8 - x*4 = 0 => 16 - 4x = 0 => x=4).',
                incorrect: 'Incorrect. A singular matrix has a determinant of zero.'
            },
            q13: {
                correct: 'Correct! The transpose of a product is (AB)<sup>T</sup> = B<sup>T</sup> A<sup>T</sup>.',
                incorrect: 'Incorrect. The transpose of a product of matrices reverses their order.'
            },
            q14: {
                correct: 'Correct! a<sub>ij</sub> denotes the element in the i-th row and j-th column.',
                incorrect: 'Incorrect. The element is denoted by a<sub>ij</sub>.'
            },
            q15: {
                correct: 'Correct! A symmetric matrix is equal to its transpose (A = A<sup>T</sup>).',
                incorrect: 'Incorrect. A symmetric matrix satisfies A = A<sup>T</sup>.'
            },
            q16: {
                correct: 'Correct! The product of a matrix and its inverse is the identity matrix.',
                incorrect: 'Incorrect. The product of a matrix and its inverse is the identity matrix.'
            },
            q17: {
                correct: 'Correct! The inverse of an inverse is the original matrix.',
                incorrect: 'Incorrect. (A<sup>-1</sup>)<sup>-1</sup> = A.'
            },
            q18: {
                correct: 'Correct! In a scalar matrix, all diagonal elements are equal.',
                incorrect: 'Incorrect. All diagonal elements are equal in a scalar matrix.'
            },
            q19: {
                correct: 'Correct! The determinant of any identity matrix is always 1.',
                incorrect: 'Incorrect. The determinant of an identity matrix is 1.'
            },
            q20: {
                correct: 'Correct! The transpose of a sum is the sum of the transposes (A+B)<sup>T</sup> = A<sup>T</sup> + B<sup>T</sup>.',
                incorrect: 'Incorrect. The transpose of a sum of matrices is the sum of their transposes.'
            }
        };

        // Global variables to store student information and quiz data
        let studentName = '';
        let studentEmail = '';
        let studentScore = 0;
        let quizAttemptData = []; // Array to store detailed quiz attempt for download

        // Get modal elements
        const customModal = document.getElementById('customModal');
        const modalMessage = document.getElementById('modalMessage');
        const closeButton = document.querySelector('.close-button');

        // Function to display custom modal message
        function showModal(message) {
            modalMessage.textContent = message;
            customModal.style.display = 'flex'; // Use flex to center content
        }

        // Function to close custom modal
        function closeModal() {
            customModal.style.display = 'none';
        }

        // Event listeners for closing modal
        closeButton.addEventListener('click', closeModal);
        window.addEventListener('click', (event) => {
            if (event.target === customModal) {
                closeModal();
            }
        });

        /**
         * Starts the quiz by validating student name and displaying the quiz section.
         * Clears any previous quiz selections and feedback.
         */
        function startQuiz() {
            studentName = document.getElementById('studentName').value.trim();
            studentEmail = document.getElementById('studentEmail').value.trim();

            // Validate student name using custom modal
            if (studentName === '') {
                showModal('Please enter your name to start the quiz.');
                return;
            }

            // Clear previous selections and feedback on retake
            const quizForm = document.getElementById('matrixQuiz');
            quizForm.reset(); // Resets all form fields (radio buttons)
            const feedbackDivs = document.querySelectorAll('.feedback');
            feedbackDivs.forEach(div => {
                div.style.display = 'none'; // Hide feedback divs
                div.className = 'feedback'; // Reset feedback styling
            });

            // Hide initial screen and show quiz section
            document.getElementById('initialScreen').style.display = 'none';
            document.getElementById('quizSection').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none'; // Ensure results are hidden
        }

        /**
         * Handles the quiz submission, calculates score, displays feedback,
         * and shows the result section.
         */
        document.getElementById('matrixQuiz').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission (page reload)
            studentScore = 0; // Reset score for the current attempt
            quizAttemptData = []; // Clear previous attempt data for detailed report

            // Iterate through each question to check answers and provide feedback
            for (let i = 1; i <= 20; i++) {
                const questionName = `q${i}`;
                // Get the selected radio button for the current question
                const selectedOption = document.querySelector(`input[name="${questionName}"]:checked`);
                const feedbackDiv = document.getElementById(`feedback${i}`);

                let isCorrect = false;
                let userAnswer = '';
                const questionElement = document.querySelector(`[name="${questionName}"]`).closest('.question');
                const questionText = questionElement ? questionElement.querySelector('p').innerText.trim() : `Question ${i}`;


                if (selectedOption) {
                    userAnswer = selectedOption.value;
                    if (userAnswer === correctAnswers[questionName]) {
                        studentScore++; // Increment score if correct
                        isCorrect = true;
                        feedbackDiv.className = 'feedback correct-feedback';
                        feedbackDiv.innerHTML = `<strong>Correct!</strong> ${feedbackMessages[questionName].correct}`;
                    } else {
                        feedbackDiv.className = 'feedback incorrect-feedback';
                        feedbackDiv.innerHTML = `<strong>Incorrect.</strong> Your answer: ${userAnswer}. ${feedbackMessages[questionName].incorrect} (Correct: ${correctAnswers[questionName]})`;
                    }
                } else {
                    // If no option was selected
                    feedbackDiv.className = 'feedback incorrect-feedback';
                    feedbackDiv.innerHTML = `<strong>No answer selected.</strong> The correct answer was: ${correctAnswers[questionName]}. ${feedbackMessages[questionName].incorrect}`;
                }
                feedbackDiv.style.display = 'block'; // Show the feedback for each question

                // Store detailed attempt data for CSV download
                quizAttemptData.push({
                    question: questionText,
                    userAnswer: userAnswer,
                    correctAnswer: correctAnswers[questionName],
                    isCorrect: isCorrect
                });
            }

            // Hide quiz section and show result section
            document.getElementById('quizSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'block';

            // Display student's name, email, and score in the result section
            document.getElementById('displayStudentName').textContent = studentName;
            document.getElementById('displayStudentEmail').textContent = studentEmail === '' ? 'Not provided' : studentEmail;
            document.getElementById('scoreDisplay').textContent = studentScore;
        });

        /**
         * Generates and downloads a CSV file containing the quiz results.
         * Includes overall score and detailed answers for each question.
         */
        function downloadResults() {
            let csvContent = "data:text/csv;charset=utf-8,";

            // Add overall student info and score
            csvContent += "Name,Email,Total Score\n";
            csvContent += `"${studentName.replace(/"/g, '""')}","${studentEmail.replace(/"/g, '""')}",${studentScore}/20\n\n`;

            // Add header for detailed question results
            csvContent += "Question,User Answer,Correct Answer,Status\n";

            // Add detailed results for each question
            quizAttemptData.forEach(function(item) {
                // Escape double quotes within text fields for CSV compatibility
                const questionText = `"${item.question.replace(/"/g, '""')}"`;
                const userAnswer = `"${item.userAnswer.replace(/"/g, '""')}"`;
                const correctAnswer = `"${item.correctAnswer.replace(/"/g, '""')}"`;
                const status = item.isCorrect ? 'Correct' : 'Incorrect';
                csvContent += `${questionText},${userAnswer},${correctAnswer},${status}\n`;
            });

            // Create a temporary link element to trigger the download
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `${studentName.replace(/ /g, '_')}_Matrix_Quiz_Results.csv`); // Dynamic filename
            document.body.appendChild(link); // Required for Firefox to click
            link.click(); // Programmatically click the link to trigger download
            document.body.removeChild(link); // Clean up the temporary link
        }

        /**
         * Resets the quiz to its initial state, allowing the user to retake it.
         * Clears input fields and resets quiz data.
         */
        function retakeQuiz() {
            document.getElementById('resultSection').style.display = 'none'; // Hide results
            document.getElementById('initialScreen').style.display = 'block'; // Show initial screen
            document.getElementById('studentName').value = ''; // Clear name input
            document.getElementById('studentEmail').value = ''; // Clear email input
            studentName = ''; // Reset student name variable
            studentEmail = ''; // Reset student email variable
            studentScore = 0; // Reset score
            quizAttemptData = []; // Clear all stored quiz attempt data
            // The startQuiz function will handle resetting form selections and feedback visibility.
        }
    </script>

</body>
</html>
